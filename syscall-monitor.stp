global ppids

probe begin {
	ppids [target ()] = 1
}

function escape (s) {
	cs = str_replace (s, "'", "\\'")
	return str_replace (cs, ",", "\\,")
}

probe kprocess.create {
	if ( ppids [pid ()] ) {
		ppids [ new_pid ] = 1;
	}
}

probe syscall.open.return {
	if ( ppids [pid ()] ) {
		printf ("'PROBE','%s','%s','%ld'\n", name, escape (user_string ($filename)), $return)
	}
}

probe syscall.creat.return {
	if ( ppids [pid ()] ) {
		printf ("'PROBE','%s','%s','%ld'\n", name, escape (user_string ($pathname)), $return)
	}
}

probe syscall.access.return {
	if ( ppids [pid ()] ) {
		printf ("'PROBE','%s','%s','%ld'\n", name, escape (user_string ($filename)), $return)
	}
}

probe syscall.stat.return {
	if ( ppids [pid ()] ) {
		printf ("'PROBE','%s','%s','%ld'\n", name, escape (user_string ($filename)), $return)
	}
}

probe syscall.lstat.return {
	if ( ppids [pid ()] ) {
		printf ("'PROBE','%s','%s','%ld'\n", name, escape (user_string ($filename)), $return)
	}
}

probe syscall.statfs.return {
	if ( ppids [pid ()] ) {
		printf ("'PROBE','%s','%s','%ld'\n", name, escape (user_string ($pathname)), $return)
	}
}

probe timer.s (10) {
	printf ("'TIMEOUT'\n")
	exit ()
}
